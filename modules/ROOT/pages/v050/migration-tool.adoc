= Migration to Mule 4
ifndef::env-site,env-github[]
include::_attributes[]
endif::[]

//TODO: FOR GA, REMOVE *Beta* FROM GA VERSION
*Beta Release: Mule Migration Assistant (MMA) and Compatibility Module*

This section provides guidance on migrating a Mule 3 app to Mule 4 with the
Mule Migration Assistant (MMA).

The migration process is a multi-part procedure, where you:

. Perform any pre-migration steps, such as migrating from the DataMapper to DataWeave.
. Run the migrator on a Mule 3 project.
. Import the migrator output into a supported version of Studio 7.
. Review the Migration report.
. Perform a manual migration on what the MMA does not migrate.
. Remove uses of Compatibility module components.
. Run any migrated MUnit tests.

These steps are detailed in xref:migration-tool-procedure[Perform a Migration to Mule 4]. However, before proceeding with a migration, it is important to review the rest of this topic, which describes the <<migration_tool>>, the <<compatibility_module>>, and <<whats_migrated>>.

[[migration_tool]]
== Mule Migration Assistant

The Mule Migration Assistant (MMA) automates the migration of Mule 3
apps to Mule 4. Though the MMA does not migrate the app entirely,
it provides significant help with these tasks:

* Migrating the project structure.
* Automatically creating descriptor files, such as `pom.xml` or `mule-artifact.json`.
* Automatically performing a great number of adaptations in the app's
code.
* Providing guidance on how to manually migrate components and patterns that
cannot be migrated automatically.

The migrator helps with such heavy lifting, but it is not to be expected to
deliver a fully functional app. Some additional steps are required.
Those steps include testing and can also include:

* Manual migration of unsupported components.
* Manual migration of complex MEL expressions to DataWeave.
* Manual migration of complex DataWeave transformations.
* Prior migration of the DataMapper with the _DataWeave_ Migration tool,
_before_ running the MMA.

It is important to note that the MMA does not support incremental migrations.

[[compatibility_module]]
== Compatibility Module

Some components or patterns cannot be migrated automatically by transforming
the app's XML. For such cases, the migrator adds the Compatibility
module to your project. The Compatibility module is a set of components that
either adapts Mule 3 components into the Mule 4 architecture, or in some cases,
enables some Mule 3 components to work in Mule 4.

*Important:* MuleSoft recommends that you migrate to a point where the
Compatibility module can be dropped from your app and that you simply use the
module as a bridge until the manual steps of the migration are complete.

The Compatibility module does not cover every migration gap. Instead, it
complements the MMA:

 * By providing MEL support for the cases where a MEL expression could not be
 migrated to DataWeave automatically.
 * By adapting the Mule 3 Message model to Mule 4.

You or your team will need to handle other migration gaps that are covered in the xref:migration-report.adoc[Mule Migration report].

[[supported_migrations]]
== Supported Components

//TODO: FOR GA, REMOVE NOTE AND REVISE CONTENT, AS NEEDED
*Note on the Beta release*: This list applies to the Beta and will expand over
time.

The Mule Migration Assistant (MMA) supports the following migrations:

* Mule apps and domains only (no policies are supported)
* MEL to DataWeave expressions (simple cases only)
* Connectors:
** HTTP (`<http:listener-config/>`)
//TODO DB OPERATION AND CONFIGS FOR DIFF DBS
** Database (`<db:derby-config/>`, `<db:generic-config/>`, `<db:mysql-config/>`, `<db:oracle-config/>`)
// are we missing <ws:consumer?
** Web Service Consumer (`<ws:consumer-config/>`)
//TODO WHERE IS THIS?
** ObjectStore
* Modules:
//SCHEMA validations, No operation selected?
** Validations (`<validation:`)
** Script (`<scripting:component>` DSL only, no migration of the script itself)
** Validate JSON Schema (`<json:validate-schema/>`, validations only)
* Transports:
//<http:static-resource-handler?
** HTTP (`<http:listener/>`, `<http:request/>`)
** JMS (`<jms:inbound-endpoint/>`, `<jms:outbound-endpoint/>`)
** File (`<file:inbound-endpoint/>`, `<file:outbound-endpoint/>`)
** FTP (`<ftp:inbound-endpoint/>`, `<ftp:outbound-endpoint/>`)
** SFTP (`<sftp:inbound-endpoint/>`, `<sftp:outbound-endpoint/>`)
** VM (`vm:inbound-endpoint/>`, `<vm:outbound-endpoint/>`)
** Email: IMAP (`<imap:inbound-endpoint/>`), SMTP (`<smtp:outbound-endpoint/>`), POP3 (`<pop3:inbound-endpoint/>`)
** Quartz connector (`<quartz:inbound-endpoint/>`)
* Components:
** Async (`<async/>`)
//TODO: WHICH FILTERS? ALL?
** Batch
** Cache (`<ee:cache/>`)
** Choice (`<choice/>`)
//TODO: WHICH FILTERS? ALL? AND TO WHAT?
** Filters
** First Successful (`<first-successful/>`)
** For Each (`<foreach/>`)
** Message Enricher scope (`<enricher/>`)
** Poll scope (`<poll/>` )
** Scatter-Gather flow control (`<scatter-gather/>`)
** Transactional scope (`<transactional/>`)
** Transform Message (`<dw:transform-message/>` for DataWeave 1.0 migrates to
<`ee:transform`/> for DataWeave 2.0)
** Until Successful (`<until-successful/>`)
** Watermark
* GZip transformers
//which error handling? all?
* Error Handling
* Composite Source scope (`<composite-source/>`)
* Watermark
//Does this impact awhat the compatibility module does?
* Properties and secure properties
* Security-related:
** OAuth Provider module `<oauth2-provider/>`
** Security filters
** Checksum operations
* Spring Beans definitions
* xref:migration-tool-procedure#munit[MUnit tests]
* APIKit: APIKit Console (`<apikit:console/>`), APIKit Router (`<apikit:router/>`)
* APIKit for SOAP (also called SOAPkit): SOAP Fault (`<apikit-soap:fault/>`),
SOAP Router (`<apikit-soap:router/>`)

Note that the <<compatibility_module, Compatibility module>> supports some
additional items from Mule 3.x until you can migrate them:

* `set-property`
* `remove-property`
* `copy-properties`
* `set-session-variable`
* `remove-session-variable`

[[unsupported_migrations]]
== Unsupported Components

//TODO: FOR GA, REMOVE NOTE AND REVISE CONTENT, AS NEEDED
*Note on the Beta release*: This list applies to the Beta and will change over
time.

The MMA does not currently support the following components:

* Custom Java code, either used directly or through any of the following:
** `<custom-transformer>`
** `<custom-message-processor>`
** `<component>`
** `<pooled-component>`
** `<invoke>`
** Anything that implements the `org.mule.api.lifecycle.Callable` interface
** etc.
* DataMapper: Use the DataWeave Migration tool. See
xref:migration-tool-procedure#datamapper[Migrating from the DataMapper to DataWeave].
* Custom types defined in Studio

See also:

* xref:migration-tool-procedure#devkit[Migrating Custom DevKit Connectors]
* <<unsupported_connectors>>

[[unsupported_connectors]]
== Unsupported Connectors

Connectors that are used in an app but not currently supported by the MMA
generate this ERROR in the Migration report:

`The migration of some-connector is not supported`

Such connectors require manual migration.

To manually migrate them, see xref:migration-tool-procedure#unsupported_projects[Migrating Unsupported Connectors].

[[supported_future]]
== Supported in the Future

*Note on the Beta Release:* This list might change over time.

For future releases, MuleSoft will also support these:

* Documentation on how to migrate DataMapper transformations
* Encryption/Decryption components
* Tracking component
* XML module
* Splitter and aggregator pattern

////
* Documentation on how to migrate DataMapper transformations
* `<first-successful>`
* `<enricher>` elements
* Security Module
* Watermark
* XML and JSON module
* Splitter and aggregator pattern
////

== See Also

* xref:migration-tutorial.adoc[Mule Migration Tool Tutorial]
* xref:migration-report.adoc[Mule Migration Report]
* xref:migration-tool-post-mig.adoc[Post-Migration Tasks]
